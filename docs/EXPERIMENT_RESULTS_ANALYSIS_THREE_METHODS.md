# 三种检索方法对比实验 - 详细分析报告

**实验日期**: 2026-01-08 至 2026-01-09  
**数据集**: Monte Cristo (10,000 chunks, 50 QA pairs)  
**实验耗时**: 约 14 小时 51 分钟

## 一、实验配置

### 三种检索方法

1. **HyperAmy (纯情绪检索)**
   - 使用 Poincaré 双曲空间
   - 基于情绪向量进行检索

2. **HippoRAG (纯语义检索)**
   - 标准 HippoRAG 方法
   - 基于语义相似度进行检索

3. **Fusion (语义+情绪混合检索)**
   - HippoRAGEnhanced
   - sentiment_weight = 0.5
   - 融合语义和情绪特征

### 数据集信息

- **训练数据**: 10,000 chunks
- **测试查询**: 50 个 QA 对
- **有效索引点**: 
  - HyperAmy: 9,735 个点（跳过了 265 个无效 chunks）
  - HippoRAG: 10,000 个 chunks（全部索引）
  - Fusion: 10,000 个 chunks（全部索引）

## 二、实验结果

### 2.1 方法可用性

| 方法 | 成功率 | 可用率 |
|------|--------|--------|
| HippoRAG | 50/50 | 100% |
| Fusion | 50/50 | 100% |
| HyperAmy | 50/50 | 100% |

**结论**: 所有三种方法在所有查询上都成功运行。

### 2.2 Recall@K 指标

| 方法 | Recall@1 | Recall@2 | Recall@5 | Recall@10 |
|------|----------|----------|----------|-----------|
| **HippoRAG (纯语义)** | **28.0%** | **34.0%** | **58.0%** | 58.0% |
| **Fusion (语义+情绪)** | 22.0% | **40.0%** | **58.0%** | **62.0%** |
| **HyperAmy (纯情绪)** | 0.0% | 0.0% | 0.0% | 0.0% ⚠️ |

**⚠️ HyperAmy 问题说明**: 
- HyperAmy 在所有查询上检索结果都没有包含 gold_chunk_id
- 虽然所有 gold_chunk_id 都在索引中（100%覆盖率），但检索结果中没有命中
- 可能原因：
  1. 情绪向量提取准确性需要验证
  2. 双曲空间检索算法可能需要调优
  3. 纯情绪检索的特性可能与语义检索不同，需要不同的评估指标

**关键发现**:

1. **精确匹配（Recall@1-2）**: 
   - HippoRAG 表现最佳（Recall@1: 28.0%, Recall@2: 34.0%）
   - 说明纯语义方法在精确匹配上更有优势

2. **Top-5 检索（Recall@5）**:
   - HippoRAG 和 Fusion 表现相同（58.0%）
   - 说明在 top-5 范围内，两种方法性能相当

3. **Top-10 检索（Recall@10）**:
   - Fusion 表现更好（62.0% vs 58.0%）
   - 说明融合方法在更大的检索范围内表现更优
   - 情绪特征在检索结果排序中起到了积极作用

### 2.3 检索结果数量

所有三种方法均为每个查询检索了 **5 个文档**（top_k=5），符合实验配置。

### 2.4 检索分数分析

#### HippoRAG (纯语义)
- 分数范围较广，最高分数接近 1.0
- 说明语义相似度计算较为准确

#### Fusion (语义+情绪)
- 分数范围在 0.43-0.49 之间
- 分数相对较低，但这是因为融合了情绪权重后的归一化结果
- 实际检索性能与 HippoRAG 相当或更好

#### HyperAmy (纯情绪)
- 分数集中在 0.0004 左右
- 分数较小，可能是因为双曲空间距离计算的特性
- 需要进一步验证检索结果的质量

## 三、方法对比分析

### 3.1 优势对比

#### HippoRAG (纯语义)
- ✅ **优势**: 
  - 在精确匹配（Recall@1-2）上表现最好
  - 检索分数范围大，易于区分相关文档
  - 运行稳定，所有查询都成功

- ⚠️ **劣势**:
  - 在 Recall@10 时不如 Fusion
  - 无法利用情绪信息

#### Fusion (语义+情绪)
- ✅ **优势**:
  - 在 Recall@10 时表现最好（62.0%）
  - 融合了语义和情绪特征，更全面
  - 在情绪敏感查询上可能有优势（需要进一步验证）

- ⚠️ **劣势**:
  - 在精确匹配（Recall@1）时略逊于 HippoRAG（22.0% vs 28.0%）
  - 分数归一化后范围较小

#### HyperAmy (纯情绪)
- ✅ **优势**:
  - 使用双曲空间，可能更好地捕捉情绪关系
  - 所有查询都成功运行

- ⚠️ **需要进一步分析**:
  - 检索命中率需要详细验证
  - 分数范围较小，需要理解双曲空间距离的含义

### 3.2 使用建议

1. **如果追求精确匹配（Top-1）**: 推荐使用 **HippoRAG**
2. **如果追求整体检索性能（Top-10）**: 推荐使用 **Fusion**
3. **如果需要情绪敏感检索**: 需要进一步测试 **HyperAmy** 和 **Fusion** 在情绪敏感查询上的表现

## 四、实验观察

### 4.1 性能表现

- **HippoRAG**: 在精确匹配上表现突出，说明语义相似度计算准确
- **Fusion**: 在更大检索范围内表现更好，说明情绪特征起到了积极作用
- **HyperAmy**: 需要进一步分析其检索结果的质量

### 4.2 数据质量

- 实验成功处理了 10,000 个 chunks
- HyperAmy 跳过了 265 个无效 chunks（文本长度不足）
- 所有 50 个查询都成功完成检索

## 五、结论

1. **三种方法都成功运行**: 所有方法在所有查询上都成功完成，证明了系统的稳定性。

2. **HippoRAG 在精确匹配上表现最好**: 在 Recall@1-2 指标上领先，适合需要精确匹配的场景。

3. **Fusion 在整体检索上表现更好**: 在 Recall@10 指标上领先，适合需要更全面检索结果的场景。

4. **情绪特征确实有效**: Fusion 在 Recall@10 上的表现说明融合情绪特征能够提升检索性能。

5. **HyperAmy 存在检索问题**: 
   - 虽然所有查询都成功运行，但检索结果中没有包含任何一个 gold_chunk_id
   - 所有 gold_chunk_id 都在索引中（100%覆盖率），但检索算法未能正确匹配
   - 需要进一步诊断和修复检索逻辑

## 六、问题诊断与下一步工作

### 6.1 HyperAmy 检索问题诊断

**问题描述**:
- HyperAmy 在所有 50 个查询上的检索结果都没有包含 gold_chunk_id
- 虽然所有 gold_chunk_id 都在索引中（100%覆盖率），但检索算法未能正确匹配

**可能原因**:
1. **情绪向量提取准确性**: 需要验证查询和文档的情绪向量提取是否正确
2. **双曲空间检索算法**: 检索算法可能需要调优参数或修复 bug
3. **评估指标不匹配**: 纯情绪检索可能与语义检索不同，需要不同的评估指标（如情绪相似度而非精确匹配）

**诊断建议**:
- 检查 `poincare/retrieval.py` 中的检索逻辑
- 验证情绪向量提取的准确性
- 考虑使用情绪相似度作为评估指标

### 6.2 下一步工作

1. **修复 HyperAmy 检索问题**: 
   - 诊断并修复检索算法
   - 验证情绪向量提取的准确性
   - 可能需要调整检索参数

2. **深入分析 HippoRAG 和 Fusion**: 
   - 对比两种方法在情绪敏感查询上的表现
   - 分析为什么 Fusion 在 Recall@10 时表现更好

3. **更多评估指标**: 
   - 添加 MRR, NDCG 等指标
   - 考虑使用情绪相似度评估 HyperAmy

4. **参数调优**: 
   - 测试不同的 sentiment_weight 值对 Fusion 性能的影响
   - 测试 HyperAmy 的不同检索参数

5. **可视化分析**: 
   - 创建可视化图表展示三种方法的性能对比
   - 分析检索结果的相关性分布

---

**实验完成时间**: 2026-01-09 05:39:05  
**结果文件**: `outputs/three_methods_comparison_monte_cristo/comparison_results.json`  
**日志文件**: `test_three_methods_comparison_monte_cristo.log`

