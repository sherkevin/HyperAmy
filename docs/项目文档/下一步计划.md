# HyperAmy 项目下一步计划

## 当前状态分析

### ✅ 已完成
1. **基础框架搭建**：所有核心模块已实现
2. **macOS 兼容性**：multiprocessing 问题已修复
3. **Sentiment 模块**：情感分析模块已创建
4. **数据集测试**：小规模测试通过（100%准确率）
5. **基础功能验证**：索引、检索、问答流程完整

### ⚠️ 待完善
1. **情感增强检索**：核心功能未实现（当前只是占位符）
2. **数据集规模**：当前只有10个文档，需要更大规模验证
3. **性能优化**：检索和问答速度需要优化
4. **实验评估**：需要系统性的实验和评估

## 下一步优先级规划

### 🔴 高优先级（核心功能）

#### 1. 实现情感增强检索功能
**目标**：将情感相似度与语义相似度融合，提升检索质量

**任务**：
- [ ] 在 `retrieve` 方法中实现情感相似度计算
- [ ] 提取查询的情感向量
- [ ] 计算查询与文档的情感相似度（余弦相似度）
- [ ] 融合语义相似度和情感相似度：
  ```
  final_score = semantic_weight * semantic_score + sentiment_weight * emotion_similarity
  ```
- [ ] 根据融合分数重新排序检索结果
- [ ] 添加情感相似度阈值过滤（可选）

**预期效果**：
- 对于情感相关的查询，能检索到情感匹配的文档
- 提升情感相关任务的检索准确率

**代码位置**：`sentiment/hipporag_enhanced.py` 的 `retrieve` 方法

---

#### 2. 使用真实大规模数据集测试
**目标**：验证系统在真实场景下的性能

**任务**：
- [ ] 下载或准备 HotpotQA 完整数据集（或子集）
- [ ] 准备其他情感相关数据集（如情感分析数据集）
- [ ] 运行完整的数据集测试
- [ ] 记录性能指标（准确率、召回率、F1等）
- [ ] 对比有无情感增强的效果

**数据集建议**：
- HotpotQA（问答数据集）
- 情感分析数据集（如 IMDB、SST-2）
- 情感相关的检索数据集

---

### 🟡 中优先级（性能优化）

#### 3. 性能优化
**目标**：提升系统运行速度，使其更适合大规模应用

**任务**：
- [ ] 情感向量提取批处理优化
- [ ] 检索算法优化（减少不必要的计算）
- [ ] 缓存机制优化（情感向量缓存）
- [ ] 并行处理优化（多文档并行处理）

**当前性能瓶颈**：
- 情感向量提取：~1.3分钟/文档（可优化到批处理）
- 检索时间：~42秒/查询（可优化）
- 问答生成：~3分钟/问题（主要受API限制）

---

#### 4. 情感权重调优实验
**目标**：找到语义和情感的最佳平衡点

**任务**：
- [ ] 设计实验：测试不同 sentiment_weight 值（0.0, 0.1, 0.2, ..., 1.0）
- [ ] 在不同数据集上运行实验
- [ ] 记录性能指标变化
- [ ] 分析最佳权重值
- [ ] 可能实现自适应权重（根据查询类型动态调整）

---

### 🟢 低优先级（增强功能）

#### 5. 双曲空间情感检索集成
**目标**：利用 poincare 模块实现更高级的情感检索

**任务**：
- [ ] 将情感向量存储到双曲空间
- [ ] 实现基于双曲距离的情感检索
- [ ] 与语义检索融合
- [ ] 评估效果

**优势**：
- 双曲空间更适合表示层次结构
- 可能更好地捕捉情感关系

---

#### 6. 实验和评估框架
**目标**：建立系统化的实验和评估流程

**任务**：
- [ ] 创建实验配置管理
- [ ] 自动化实验脚本
- [ ] 结果可视化（准确率曲线、权重影响等）
- [ ] 生成实验报告

---

#### 7. 代码优化和文档完善
**目标**：提升代码质量和可维护性

**任务**：
- [ ] 代码重构和优化
- [ ] 添加详细注释
- [ ] 完善 API 文档
- [ ] 添加使用示例

---

## 推荐执行顺序

### 第一阶段（1-2周）：核心功能实现
1. **实现情感增强检索**（最重要）
2. **准备真实数据集**
3. **运行对比实验**（有/无情感增强）

### 第二阶段（1-2周）：优化和调优
4. **性能优化**
5. **情感权重调优实验**
6. **结果分析和报告**

### 第三阶段（可选）：增强功能
7. **双曲空间集成**
8. **实验框架完善**
9. **代码优化**

---

## 关键指标

### 需要关注的指标
1. **检索准确率**：Recall@K, MRR
2. **问答准确率**：ExactMatch, F1
3. **情感相关性**：情感匹配度
4. **性能指标**：处理速度、延迟
5. **对比实验**：baseline vs 情感增强

---

## 风险评估

### 潜在问题
1. **情感增强可能不总是有效**：对于事实性查询，情感可能不重要
2. **性能开销**：情感向量提取和计算可能增加延迟
3. **数据集限制**：需要情感相关的数据集才能体现优势

### 应对策略
1. **自适应权重**：根据查询类型动态调整
2. **性能优化**：批处理、缓存、并行
3. **多数据集验证**：在不同类型数据集上测试

---

## 成功标准

### 短期目标（1个月内）
- ✅ 情感增强检索功能完整实现
- ✅ 在至少一个真实数据集上验证
- ✅ 证明情感增强能提升检索质量（至少在某些场景下）

### 长期目标（论文发表）
- ✅ 系统化的实验和评估
- ✅ 与多个 baseline 对比
- ✅ 在多个数据集上验证
- ✅ 性能达到可接受水平

---

## 下一步行动

**立即开始**：
1. 实现情感增强检索功能（`sentiment/hipporag_enhanced.py`）
2. 准备更大规模的数据集
3. 设计对比实验

**需要决策**：
- 选择哪些数据集进行测试？
- 情感权重范围如何设置？
- 是否需要实现自适应权重？

---

## 总结

**当前最紧迫的任务**是实现情感增强检索功能，这是项目的核心创新点。只有实现了这个功能，才能真正验证情感增强RAG的有效性。

建议优先完成：
1. 🔴 情感增强检索实现
2. 🔴 真实数据集测试
3. 🟡 性能优化
4. 🟡 实验和评估

