# 严谨实验计划

## 当前状态

### ✅ 已完成
- 情感增强检索功能实现
- 初步验证实验（功能验证）

### ⚠️ 当前实验的局限性
- 样本量太小（4个查询）
- 评估方法不标准（关键词匹配）
- 没有统计显著性检验
- 数据集是人工构造的

## 严谨实验设计

### 1. 数据集选择

#### 选项 A: HotpotQA（推荐）
- **优势**: 
  - 标准问答数据集
  - 有标准答案
  - 可以构造相关文档标注
- **规模**: 使用完整数据集或子集（至少 100-1000 个查询）
- **获取**: 从官方下载或使用 HuggingFace datasets

#### 选项 B: MS MARCO
- **优势**: 
  - 标准检索数据集
  - 有相关文档标注
  - 广泛使用，结果可对比
- **规模**: 使用 dev set（至少 1000 个查询）
- **获取**: 从官方下载

#### 选项 C: 情感相关数据集
- **选项**: 
  - IMDB 评论数据集（情感分类）
  - SST-2（情感分析）
  - 自定义情感检索数据集
- **优势**: 直接测试情感相关任务
- **劣势**: 可能不是标准检索任务

### 2. 评估指标

#### 检索评估
- **Recall@K** (K=1, 5, 10, 20): 检索到的相关文档比例
- **MRR (Mean Reciprocal Rank)**: 平均倒数排名
- **NDCG@K**: 归一化折损累积增益
- **MAP (Mean Average Precision)**: 平均精度均值

#### 问答评估
- **ExactMatch**: 精确匹配率
- **F1 Score**: F1 分数

### 3. 实验设计

#### 实验 1: 基础对比
- **Baseline**: HippoRAG（无情感增强）
- **实验组**: HippoRAGEnhanced（情感权重 0.3）
- **数据集**: HotpotQA（100+ 查询）
- **评估**: Recall@K, MRR, ExactMatch, F1

#### 实验 2: 情感权重调优
- **测试权重**: 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0
- **目标**: 找到最佳情感权重
- **评估**: 在验证集上选择最佳权重

#### 实验 3: 查询类型分析
- **情感相关查询**: 明确包含情感词汇的查询
- **事实性查询**: 纯事实性问题
- **混合查询**: 包含事实和情感的查询
- **目标**: 分析情感增强在不同查询类型下的效果

#### 实验 4: 消融实验
- **完整系统**: 语义 + 情感
- **仅语义**: 情感权重 = 0.0
- **仅情感**: 语义权重 = 0.0（仅作对比）
- **目标**: 分析各组件贡献

### 4. 统计显著性检验

#### 方法
- **Wilcoxon signed-rank test**: 配对样本，非参数检验
- **t-test**: 如果数据符合正态分布
- **置信区间**: 95% 置信区间

#### 要求
- 样本量: 至少 30+ 查询（建议 100+）
- p-value < 0.05 才认为有统计显著性

### 5. 实验脚本

已创建 `test/test_rigorous_comparison.py`，包含：
- 标准评估指标（Recall@K）
- 统计显著性检验框架
- 置信区间计算

### 6. 结果报告格式

#### 必须包含
1. **数据集描述**: 名称、规模、来源
2. **评估指标**: 使用的所有指标
3. **Baseline 结果**: 详细数值
4. **实验组结果**: 详细数值
5. **改进幅度**: 绝对值和相对值
6. **统计显著性**: p-value, 置信区间
7. **案例分析**: 成功和失败的例子

#### 示例格式
```
数据集: HotpotQA (100 queries)
评估指标: Recall@5, MRR, ExactMatch, F1

Baseline:
  Recall@5: 0.6234
  MRR: 0.7123
  ExactMatch: 0.4500
  F1: 0.5234

情感增强 (weight=0.3):
  Recall@5: 0.6789 (+0.0555, +8.9%)
  MRR: 0.7456 (+0.0333, +4.7%)
  ExactMatch: 0.4600 (+0.0100, +2.2%)
  F1: 0.5345 (+0.0111, +2.1%)

统计显著性:
  Wilcoxon test: p = 0.0234 < 0.05 ✅
  95% CI: [0.0123, 0.0987]
```

## 实施步骤

### 阶段 1: 准备标准数据集（1-2天）
1. 下载 HotpotQA 或 MS MARCO
2. 准备数据格式（转换为项目格式）
3. 准备相关文档标注（gold_docs）

### 阶段 2: 运行基础对比实验（2-3天）
1. 运行 Baseline
2. 运行情感增强版本
3. 计算标准评估指标
4. 进行统计显著性检验

### 阶段 3: 权重调优实验（2-3天）
1. 测试不同权重值
2. 在验证集上选择最佳权重
3. 在测试集上验证

### 阶段 4: 分析和报告（1-2天）
1. 统计分析
2. 案例分析
3. 生成实验报告

## 当前可用的工具

1. ✅ `test/test_rigorous_comparison.py` - 严谨对比实验框架
2. ✅ `hipporag/evaluation/retrieval_eval.py` - 标准评估指标
3. ✅ `hipporag/evaluation/qa_eval.py` - 问答评估指标

## 建议

### 立即行动
1. **下载标准数据集**（HotpotQA 或 MS MARCO）
2. **准备数据格式**（转换为项目格式）
3. **运行严谨实验**（使用标准指标和统计检验）

### 论文使用
- ❌ **不要**直接使用当前 8.3% 的提升数字
- ✅ **应该**使用标准数据集和指标的结果
- ✅ **必须**报告统计显著性检验
- ✅ **建议**进行多数据集验证

## 总结

当前实验**足够验证功能**，但**不够严谨**用于论文结论。

需要：
1. 标准数据集（100+ 查询）
2. 标准评估指标（Recall@K, MRR）
3. 统计显著性检验
4. 多种查询类型

建议优先完成严谨实验，再得出性能提升的结论。

