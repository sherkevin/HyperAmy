# 严谨实验运行说明

## 关于电脑开机

### ⚠️ 重要说明

**是的，实验需要电脑保持开机**，因为：
1. 实验是同步运行的（需要等待 API 响应）
2. 需要持续运行数小时（2-4小时）
3. 虽然支持断点续传，但中断后需要手动重新启动

### ✅ 好消息

实验脚本**支持断点续传**：
- 如果中断，已完成的步骤不会重复
- 重新运行会自动从断点继续
- 中间结果会自动保存

## 运行方式

### 方式 1: 后台运行（推荐）

使用提供的脚本在后台运行：

```bash
cd /Users/ginger/Desktop/学术教育/科研计划/nips/HyperAmy

# 给脚本执行权限
chmod +x scripts/run_experiment_background.sh
chmod +x scripts/check_experiment_status.sh

# 后台启动实验
./scripts/run_experiment_background.sh
```

**优点**:
- 可以在后台运行
- 即使关闭终端也不会中断
- 可以随时查看进度

**注意**: 电脑仍需保持开机和唤醒状态

### 方式 2: 使用 screen/tmux（推荐）

如果安装了 screen 或 tmux，可以在会话中运行：

```bash
# 使用 screen
screen -S experiment
python -m test.test_rigorous_comparison_save
# 按 Ctrl+A 然后 D 来 detach

# 重新连接
screen -r experiment

# 使用 tmux
tmux new -s experiment
python -m test.test_rigorous_comparison_save
# 按 Ctrl+B 然后 D 来 detach

# 重新连接
tmux attach -t experiment
```

**优点**:
- 可以 detach 和 reattach
- 即使 SSH 断开也能继续
- 方便查看实时输出

### 方式 3: 直接运行（简单但需要保持终端）

```bash
python -m test.test_rigorous_comparison_save
```

**缺点**: 
- 需要保持终端打开
- 如果终端关闭，进程会中断

## 检查实验状态

```bash
# 使用检查脚本
./scripts/check_experiment_status.sh

# 或手动检查
ps aux | grep test_rigorous_comparison_save

# 查看最新日志
ls -lt outputs/rigorous_experiment/logs/ | head -5
tail -f outputs/rigorous_experiment/logs/experiment_*.log
```

## 如果电脑需要关机

### 方案 1: 等待实验完成（推荐）

如果可能，等待实验完成后再关机。

### 方案 2: 中断后继续

如果必须关机：
1. **保存当前状态**: 实验脚本会自动保存中间结果
2. **关机**: 正常关机即可
3. **重新运行**: 开机后重新运行脚本，会自动从断点继续

```bash
# 重新运行（会自动跳过已完成的步骤）
python -m test.test_rigorous_comparison_save
```

### 方案 3: 分批运行

可以修改脚本，分批运行实验：

```python
# 在 test_rigorous_comparison_save.py 中
MAX_QUERIES = 10  # 先运行10个查询
# 完成后，再改为 20, 30, ... 逐步增加
```

## 实验进度跟踪

实验会自动保存进度：

1. **Baseline 结果**: `outputs/rigorous_experiment/baseline_results.json`
2. **Enhanced 结果**: `outputs/rigorous_experiment/enhanced_results.json`
3. **对比结果**: `outputs/rigorous_experiment/comparison_results.json`

如果这些文件存在，说明对应步骤已完成。

## 预计时间

- **Baseline 索引**: 30-60 分钟
- **Baseline 检索**: 10-20 分钟
- **Enhanced 索引**: 30-60 分钟（包含情感向量提取）
- **Enhanced 检索**: 15-30 分钟

**总计**: 约 2-4 小时

## 建议

1. **选择合适的时间**: 在不需要使用电脑时运行
2. **保持电脑唤醒**: 确保电脑不会自动休眠
3. **检查网络**: 确保网络连接稳定
4. **监控进度**: 定期检查实验状态

## 防止电脑休眠

### macOS 设置

```bash
# 防止休眠（需要时）
caffeinate -d

# 或在系统设置中：
# 系统偏好设置 > 节能 > 防止电脑自动进入休眠
```

## 总结

- ✅ **需要保持电脑开机**（实验需要持续运行）
- ✅ **支持断点续传**（中断后可以继续）
- ✅ **可以后台运行**（使用提供的脚本）
- ✅ **自动保存进度**（中间结果会保存）

**最佳实践**: 使用后台运行脚本，在不需要使用电脑时启动实验，定期检查进度。

