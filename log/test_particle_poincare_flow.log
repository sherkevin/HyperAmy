WARNING 12-26 16:22:21 [importing.py:53] Triton is installed, but `triton.backends` could not be imported. Disabling Triton.
INFO 12-26 16:22:21 [importing.py:68] Triton not installed or not compatible; certain GPU-related functions will not be available.
[2025-12-26 16:22:23] INFO test_particle_poincare_flow.py:92: 清理旧的测试数据库: ./hyperamy_db_test_particles
[2025-12-26 16:22:23] INFO posthog.py:22: Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
[2025-12-26 16:22:23] INFO chroma_client.py:36: ChromaClient initialized: path=./hyperamy_db_test_particles, collection=test_particles
[2025-12-26 16:22:23] INFO storage.py:37: HyperAmyStorage initialized: path=./hyperamy_db_test_particles, collection=test_particles
[2025-12-26 16:22:23] INFO storage.py:128: Batch upserted 3 entities
================================================================================
测试：粒子创建 -> 存储 -> 查询完整流程
================================================================================

【Step 1】初始化组件...
  - 最大半径: 100.0
✓ 组件初始化成功
  - 投影器: curvature=1.0, scaling_factor=2.0
  - Collection: test_particles
  - 存储路径: ./hyperamy_db_test_particles (由 collection_name 隐式决定)

【Step 2】创建粒子（初始状态）...
✓ 创建了 3 个测试粒子:
  - particle_A: 愤怒(高), speed=0.90, T=0.50, weight=0.9055
  - particle_B: 愤怒(低), speed=0.30, T=0.50, weight=0.4528
  - particle_C: 开心, speed=0.70, T=0.60, weight=0.9055

【Step 3】查看初始状态的双曲空间坐标...
✓ 粒子 A 的双曲空间状态:
  - 双曲坐标: [0.714599609375, 0.0793999582529068, 0.0]... (前3维)
  - 当前速度: 0.9000
  - 当前温度: 0.5000
  - 坐标范数: 0.7190
  - 距离原点: 1.8111
  - 粒子质量: 0.9055
  - 是否消失: 否

【Step 4】存储粒子到庞加莱球...
✓ 粒子存储成功
  - 存储了 3 个粒子
  - 链接关系: A <-> B

【Step 5】等待一段时间（模拟时间流逝）...
  等待 2.0 秒...
✓ 时间已过去 2.15 秒

【Step 6】查询粒子状态...
  使用 particle_A 作为查询粒子...
✓ 查询完成，找到 3 个结果:
--------------------------------------------------------------------------------

结果 1:
  - ID: particle_A
  - 匹配类型: direct
  - 双曲距离: 0.0005
  - 元数据:
    * speed (v): 0.9
    * temperature (T): 0.5
    * born: 1766737343.7913876
    * entity: Entity_particle_A
    * text_id: text_particle_A
  - 查询时的动态状态:
    * 双曲坐标: [0.9479701519012451, 0.10533002018928528, 0.0]... (前3维)
    * 当前速度: 0.9000
    * 当前温度: 0.5000
    * 距离原点: 3.7446
    * 是否消失: 否

结果 2:
  - ID: particle_B
  - 匹配类型: direct
  - 双曲距离: 2.1946
  - 元数据:
    * speed (v): 0.3
    * temperature (T): 0.5
    * born: 1766737343.7914183
    * entity: Entity_particle_B
    * text_id: text_particle_B

结果 3:
  - ID: particle_C
  - 匹配类型: direct
  - 双曲距离: 6.3562
  - 元数据:
    * speed (v): 0.7
    * temperature (T): 0.6
    * born: 1766737343.791439
    * entity: Entity_particle_C
    * text_id: text_particle_C

【Step 7】验证查询结果...
✓ 验证结果:
  - 找到粒子 A: 是
  - 找到粒子 B (邻居): 是
  - A 到自己的距离: 0.000488 (应该接近 0)
  - B 的匹配类型: direct

================================================================================
✓ 测试完成！
================================================================================

================================================================================
测试：时间演化验证
================================================================================

时间演化状态:
--------------------------------------------------------------------------------
时间点(s)       当前速度         当前温度         距离原点         坐标范数         状态        
--------------------------------------------------------------------------------
0            0.8000       0.6000       1.6492       0.6776       正常        
1            0.8000       0.6000       2.4492       0.8410       正常        
5            0.8000       0.6000       5.6492       0.9930       正常        
10           0.8000       0.6000       9.6492       0.9999       正常        
50           0.8000       0.6000       41.6492      1.0000       正常        
100          0.8000       0.6000       81.6492      1.0000       正常        
--------------------------------------------------------------------------------
✓ 时间演化测试完成
  注意：
  - 当前 TimePhysics 实现为恒等映射，速度和温度不随时间变化
  - 但粒子距离原点会随时间增加：距离 = 初始距离 + 速度 × 时间
  - 当距离 >= 最大半径(100)时，粒子被认为已消失

================================================================================
测试：粒子追踪 - 完整状态信息
================================================================================

【粒子初始信息】
--------------------------------------------------------------------------------
  - 实体 ID: tracked_particle
  - 实体名称: TrackedEntity
  - 文本 ID: text_tracked
  - 情绪向量形状: (30,)
  - 情绪向量（前5维）: [0.9938837346736189, 0.11043152607484655, 0.0, 0.0, 0.0]
  - 粒子质量 (weight): 0.905539
  - 初始速度 (speed): 0.500000
  - 初始温度 (temperature): 0.700000
  - 生成时间 (born): 1766737345.980368
  - 初始距离 (weight × scaling_factor): 1.811077
--------------------------------------------------------------------------------

【粒子状态追踪】
========================================================================================================================
时间点(s)       距离原点         距离增量         预期增量         坐标范数         速度         温度         状态        
========================================================================================================================
0            1.811077     -            -            0.718984     0.500000   0.700000   正常        
1            2.311077     0.500000 ✓   0.500000     0.819581     0.500000   0.700000   正常        
2            2.811077     0.500000 ✓   0.500000     0.886543     0.500000   0.700000   正常        
5            4.311077     1.500000 ✓   1.500000     0.973517     0.500000   0.700000   正常        
10           6.811077     2.500000 ✓   2.500000     0.997799     0.500000   0.700000   正常        
20           11.811077    5.000000 ✓   5.000000     0.999985     0.500000   0.700000   正常        
50           26.811077    15.000000 ✓  15.000000    1.000000     0.500000   0.700000   正常        
100          51.811077    25.000000 ✓  25.000000    1.000000     0.500000   0.700000   正常        
150          76.811077    25.000000 ✓  25.000000    1.000000     0.500000   0.700000   正常        
200          100.000000   23.188923 ✗(1.811077) 25.000000    1.000000     0.500000   0.700000   已消失       
========================================================================================================================

【距离计算验证】
--------------------------------------------------------------------------------
时间点(s)       计算距离            公式计算            差值              状态        
--------------------------------------------------------------------------------
0            1.811077        1.811077        0.000000e+00    ✓ 正常        
5            4.311077        4.311077        0.000000e+00    ✓ 正常        
10           6.811077        6.811077        0.000000e+00    ✓ 正常        
50           26.811077       26.811077       0.000000e+00    ✓ 正常        
--------------------------------------------------------------------------------

【粒子完整信息摘要】
--------------------------------------------------------------------------------
实体信息:
  - entity_id: tracked_particle
  - entity: TrackedEntity
  - text_id: text_tracked

物理属性:
  - weight (质量): 0.905539 (初始情绪向量模长)
  - speed (速度): 0.500000
  - temperature (温度): 0.700000
  - born (生成时间): 1766737345.980368

空间属性:
  - emotion_vector (归一化方向向量): shape=(30,)
  - emotion_vector 前5维: [0.9938837346736189, 0.11043152607484655, 0.0, 0.0, 0.0]
  - emotion_vector 模长: 1.000000 (应该为 1.0)

计算参数:
  - 初始距离: 1.811077 = weight(0.905539) × scaling_factor(2.0)
  - 距离公式: distance(t) = 1.811077 + 0.500000 × t
  - 最大半径: 100.0
--------------------------------------------------------------------------------

✓ 粒子追踪测试完成
  验证结果:
  - 距离随时间线性增加：距离 = 初始距离 + 速度 × 时间
  - 距离增量 = 速度 × 时间差
  - 当距离 >= 最大半径时，粒子标记为已消失
