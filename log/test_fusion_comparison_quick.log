[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 融合检索对比测试（快速版）：GraphFusion vs HippoRAG vs Amygdala
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
【使用已有数据库初始化系统】
[INFO] [__main__] 
[1/3] 加载图谱融合检索器...
[INFO] [workflow.graph_fusion_retrieval] 初始化 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [chromadb.telemetry.product.posthog] Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ Amygdala 初始化完成
[INFO] [workflow.graph_fusion_retrieval] 初始化 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ HippoRAG 初始化完成
[INFO] [workflow.graph_fusion_retrieval] ✓ 图谱融合检索器初始化完成
[INFO] [__main__] ✓ 图谱融合检索器加载完成
[INFO] [__main__] 
[2/3] 加载 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [__main__] ✓ HippoRAG 加载完成
[INFO] [__main__] 
[3/3] 加载 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [__main__] ✓ Amygdala 加载完成
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 1】图谱融合检索
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offere...
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 开始融合检索
[INFO] [workflow.graph_fusion_retrieval]   Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [workflow.graph_fusion_retrieval]   权重配置: emotion=0.3, semantic=0.5, fact=0.2
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 1: 从 query 抽取实体
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767165448
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767165448
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Count' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: distrust, resentment, defiance, resolve, bitterness, restraint
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'muscatel grapes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, disdain, coldness
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'refreshment' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, aversion, coldness
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Madame de Morcerf' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, pride, defiance, resentment, disdain
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Mercedes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, discomfort, coldness
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'visit' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: distrust, resentment, rejection, coldness, disdain
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'house' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, discomfort, tension, suspicion, unease
[INFO] [utils.sentence] Generated 7 affective descriptions for 7 entities
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始生成情绪嵌入向量...
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165448_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165448_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165448_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165448_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165448_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165448_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165448_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767165448_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767165448_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767165448_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767165448_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767165448_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767165448_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767165448_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767165448_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767165448_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767165448_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767165448_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767165448_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767165448_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767165448_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767165448
[INFO] [workflow.graph_fusion_retrieval]   ✓ 抽取到 7 个实体: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 2: 获取 query embedding
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [workflow.graph_fusion_retrieval]   ✓ Query embedding 准备完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 3: HippoRAG 语义扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 语义扩展找到 0 个相似实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 4: Amygdala 情绪扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 情绪扩展找到 0 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 5: 提取 HippoRAG fact 实体
[INFO] [workflow.graph_fusion_retrieval]   ✓ Fact 扩展找到 19 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 6: 融合实体权重
[INFO] [workflow.graph_fusion_retrieval]     - Query 实体: 7
[INFO] [workflow.graph_fusion_retrieval]     - 语义实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - 情绪实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - Fact 实体: 19
[INFO] [workflow.graph_fusion_retrieval]     - 合并后唯一实体: 26
[INFO] [workflow.graph_fusion_retrieval]   ✓ 融合后共有 46 个实体节点
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 7: 运行 PPR 传播
[INFO] [workflow.graph_fusion_retrieval]   ✓ PPR 完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 检索完成，耗时 50.41s
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [__main__] 
【融合检索结果】（耗时: 50.41s）
[INFO] [__main__]   Rank 1: 情感对峙 (PPR分数: 0.0111)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (PPR分数: 0.0175)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (PPR分数: 0.0165)
[INFO] [__main__]   Rank 4: 药丸场景 (PPR分数: 0.0192)
[INFO] [__main__]   Rank 5: 早餐场景 (PPR分数: 0.0231)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 2】HippoRAG 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [workflow.hipporag_wrapper] Retrieving top-5 chunks for query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morce...
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [hipporag.HippoRAG] Total Retrieval Time 16.42s
[INFO] [hipporag.HippoRAG] Total Recognition Memory Time 15.33s
[INFO] [hipporag.HippoRAG] Total PPR Time 0.00s
[INFO] [hipporag.HippoRAG] Total Misc Time 1.09s
[INFO] [workflow.hipporag_wrapper] ✓ Retrieved 5 chunks
[INFO] [__main__] 
【HippoRAG 结果】（耗时: 16.42s）
[INFO] [__main__]   Rank 1: 情感对峙 (分数: 0.0366)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (分数: 0.0305)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (分数: 0.0223)
[INFO] [__main__]   Rank 4: 早餐场景 (分数: 0.0043)
[INFO] [__main__]   Rank 5: 药丸场景 (分数: 0.0014)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 3】Amygdala 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767165515
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767165515
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Count' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: suspicion, distrust, resolve, tension, restraint, wariness
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'muscatel grapes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, defiance, coldness
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'refreshment' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: refusal, distrust, rejection, aversion
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Madame de Morcerf' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, coldness, disapproval, distance
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Mercedes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, refusal, coldness, distance, tension
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'visit' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, coldness, discomfort, resentment
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'house' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, suspicion, discomfort, distrust, avoidance
[INFO] [utils.sentence] Generated 7 affective descriptions for 7 entities
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始生成情绪嵌入向量...
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165515_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165515_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165515_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165515_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165515_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165515_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165515_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767165515_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767165515_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767165515_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767165515_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767165515_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767165515_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767165515_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767165515_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767165515_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767165515_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767165515_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767165515_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767165515_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767165515_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767165515
[INFO] [__main__] 
【Amygdala 结果】（耗时: 48.41s）
[INFO] [__main__]   未检索到结果
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【详细对比分析】
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 1. 排名对比
[INFO] [__main__] ================================================================================
[INFO] [__main__] 
检索方式            情感对峙         东方哲学         拒绝葡萄干        药丸场景         早餐场景        
[INFO] [__main__] --------------------------------------------------------------------------------
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 融合检索对比测试（快速版）：GraphFusion vs HippoRAG vs Amygdala
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
【使用已有数据库初始化系统】
[INFO] [__main__] 
[1/3] 加载图谱融合检索器...
[INFO] [workflow.graph_fusion_retrieval] 初始化 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [chromadb.telemetry.product.posthog] Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ Amygdala 初始化完成
[INFO] [workflow.graph_fusion_retrieval] 初始化 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ HippoRAG 初始化完成
[INFO] [workflow.graph_fusion_retrieval] ✓ 图谱融合检索器初始化完成
[INFO] [__main__] ✓ 图谱融合检索器加载完成
[INFO] [__main__] 
[2/3] 加载 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [__main__] ✓ HippoRAG 加载完成
[INFO] [__main__] 
[3/3] 加载 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [__main__] ✓ Amygdala 加载完成
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 1】图谱融合检索
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offere...
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 开始融合检索
[INFO] [workflow.graph_fusion_retrieval]   Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [workflow.graph_fusion_retrieval]   权重配置: emotion=0.3, semantic=0.5, fact=0.2
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 1: 从 query 抽取实体
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767165627
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767165627
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Count' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: distrust, suspicion, resolve, pride, defiance, detachment
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'muscatel grapes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: refusal, distrust, aversion, coldness
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'refreshment' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, disdain, aversion
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Madame de Morcerf' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, suspicion, discomfort, distrust, coldness
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Mercedes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, coldness, resentment, distrust
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'visit' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: distrust, suspicion, rejection, hostility
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'house' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: distrust, suspicion, aversion, discomfort
[INFO] [utils.sentence] Generated 7 affective descriptions for 7 entities
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始生成情绪嵌入向量...
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165627_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165627_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165627_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165627_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165627_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165627_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165627_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767165627_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767165627_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767165627_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767165627_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767165627_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767165627_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767165627_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767165627_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767165627_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767165627_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767165627_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767165627_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767165627_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767165627_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767165627
[INFO] [workflow.graph_fusion_retrieval]   ✓ 抽取到 7 个实体: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 2: 获取 query embedding
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [workflow.graph_fusion_retrieval]   ✓ Query embedding 准备完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 3: HippoRAG 语义扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 语义扩展找到 0 个相似实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 4: Amygdala 情绪扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 情绪扩展找到 0 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 5: 提取 HippoRAG fact 实体
[INFO] [workflow.graph_fusion_retrieval]   ✓ Fact 扩展找到 19 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 6: 融合实体权重
[INFO] [workflow.graph_fusion_retrieval]     - Query 实体: 7
[INFO] [workflow.graph_fusion_retrieval]     - 语义实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - 情绪实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - Fact 实体: 19
[INFO] [workflow.graph_fusion_retrieval]     - 合并后唯一实体: 26
[INFO] [workflow.graph_fusion_retrieval]   ✓ 融合后共有 46 个实体节点
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 7: 运行 PPR 传播
[INFO] [workflow.graph_fusion_retrieval]   ✓ PPR 完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 检索完成，耗时 27.90s
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [__main__] 
【融合检索结果】（耗时: 27.90s）
[INFO] [__main__]   Rank 1: 情感对峙 (PPR分数: 0.0111)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (PPR分数: 0.0175)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (PPR分数: 0.0165)
[INFO] [__main__]   Rank 4: 药丸场景 (PPR分数: 0.0192)
[INFO] [__main__]   Rank 5: 早餐场景 (PPR分数: 0.0231)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 2】HippoRAG 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [workflow.hipporag_wrapper] Retrieving top-5 chunks for query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morce...
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [hipporag.HippoRAG] Total Retrieval Time 1.00s
[INFO] [hipporag.HippoRAG] Total Recognition Memory Time 0.02s
[INFO] [hipporag.HippoRAG] Total PPR Time 0.00s
[INFO] [hipporag.HippoRAG] Total Misc Time 0.98s
[INFO] [workflow.hipporag_wrapper] ✓ Retrieved 5 chunks
[INFO] [__main__] 
【HippoRAG 结果】（耗时: 1.01s）
[INFO] [__main__]   Rank 1: 情感对峙 (分数: 0.0366)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (分数: 0.0305)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (分数: 0.0223)
[INFO] [__main__]   Rank 4: 早餐场景 (分数: 0.0043)
[INFO] [__main__]   Rank 5: 药丸场景 (分数: 0.0014)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 3】Amygdala 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767165656
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767165656
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Count' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, coldness, disdain, resentment, resolve
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'muscatel grapes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: refusal, distrust, aversion, rejection
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'refreshment' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, discomfort, defiance
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Madame de Morcerf' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, coldness, discomfort
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Mercedes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, refusal, distance, coldness, tension
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'visit' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, suspicion, distrust, distance, coldness
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'house' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: suspicion, fear, caution, distrust, unease
[INFO] [utils.sentence] Generated 7 affective descriptions for 7 entities
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始生成情绪嵌入向量...
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165656_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165656_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165656_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165656_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165656_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165656_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767165656_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767165656_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767165656_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767165656_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767165656_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767165656_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767165656_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767165656_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767165656_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767165656_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767165656_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767165656_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767165656_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767165656_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767165656_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767165656
[INFO] [__main__] 
【Amygdala 结果】（耗时: 27.14s）
[INFO] [__main__]   未检索到结果
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【详细对比分析】
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 1. 排名对比
[INFO] [__main__] ================================================================================
[INFO] [__main__] 
检索方式            情感对峙         东方哲学         拒绝葡萄干        药丸场景         早餐场景        
[INFO] [__main__] --------------------------------------------------------------------------------
[INFO] [__main__] 图谱融合            1           3           2           4           5           
[INFO] [__main__] HippoRAG        1           3           2           5           4           
[INFO] [__main__] Amygdala        -           -           -           -           -           
[INFO] [__main__] 
平均排名（越低越好）:
[INFO] [__main__] 检索方式            平均排名            标准差            
[INFO] [__main__] -------------------------------------------------------
[INFO] [__main__] 图谱融合            3.00            1.41           
[INFO] [__main__] HippoRAG        3.00            1.41           
[INFO] [__main__] Amygdala        -               -              
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 2. Top-3 命中率（关键 chunks：情感对峙、东方哲学、拒绝葡萄干）
[INFO] [__main__] ================================================================================
[INFO] [__main__]   图谱融合           : 3/3 命中 (命中率: 100.0%)
[INFO] [__main__]   HippoRAG       : 3/3 命中 (命中率: 100.0%)
[INFO] [__main__]   Amygdala       : 0/3 命中 (命中率: 0.0%)
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 3. Top-1 准确率（情感对峙 - 最关键答案）
[INFO] [__main__] ================================================================================
[INFO] [__main__]   图谱融合           : ✓ Rank 1 (完美)
[INFO] [__main__]   HippoRAG       : ✓ Rank 1 (完美)
[INFO] [__main__]   Amygdala       : ✗ 未检索到
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 4. 检索性能对比
[INFO] [__main__] ================================================================================
[INFO] [__main__] 
检索方式            时间(s)           相对倍数           
[INFO] [__main__] -------------------------------------------------------
[INFO] [__main__] 图谱融合            27.90           27.75          x
[INFO] [__main__] HippoRAG        1.01            1.00           x
[INFO] [__main__] Amygdala        27.14           27.00          x
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【总结分析】
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
📊 检索效果总结:
[INFO] [__main__] 
检索方式            平均排名         Top-3命中率        Top-1准确率    
[INFO] [__main__] -----------------------------------------------------------------
[INFO] [__main__] 图谱融合            3.00         100.0          % 1.0         %
[INFO] [__main__] HippoRAG        3.00         100.0          % 1.0         %
[INFO] [__main__] 
💡 推荐建议:
[INFO] [__main__]   • 追求检索质量: 图谱融合 (平均排名: 3.00)
[INFO] [__main__]   • 追求最佳答案: 图谱融合 (Top-1 准确率: 100.0%)
[INFO] [__main__]   • 追求检索速度: HippoRAG (耗时: 1.01s)
[INFO] [__main__]   • 追求稳定性: 图谱融合 (Top-3 命中率: 100.0%)
[INFO] [__main__] 
🎯 综合评估:
[INFO] [__main__]   图谱融合: 84.0/100
[INFO] [__main__]   HippoRAG: 84.0/100
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 测试完成！
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
日志已保存到: log/test_fusion_comparison_quick.log
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 融合检索对比测试（快速版）：GraphFusion vs HippoRAG vs Amygdala
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
【使用已有数据库初始化系统】
[INFO] [__main__] 
[1/3] 加载图谱融合检索器...
[INFO] [workflow.graph_fusion_retrieval] 初始化 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_cache] EmotionCache initialized with cache_dir: ./emotion_cache
[INFO] [particle.emotion_v2] EmotionV2 caching enabled: cache_dir=./emotion_cache
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2, cache=enabled
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [chromadb.telemetry.product.posthog] Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ Amygdala 初始化完成
[INFO] [workflow.graph_fusion_retrieval] 初始化 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ HippoRAG 初始化完成
[INFO] [workflow.graph_fusion_retrieval] ✓ 图谱融合检索器初始化完成
[INFO] [__main__] ✓ 图谱融合检索器加载完成
[INFO] [__main__] 
[2/3] 加载 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [__main__] ✓ HippoRAG 加载完成
[INFO] [__main__] 
[3/3] 加载 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_cache] EmotionCache initialized with cache_dir: ./emotion_cache
[INFO] [particle.emotion_v2] EmotionV2 caching enabled: cache_dir=./emotion_cache
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2, cache=enabled
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [__main__] ✓ Amygdala 加载完成
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 1】图谱融合检索
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offere...
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 开始融合检索
[INFO] [workflow.graph_fusion_retrieval]   Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [workflow.graph_fusion_retrieval]   权重配置: emotion=0.3, semantic=0.5, fact=0.2
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 1: 从 query 抽取实体
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767227525
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767227525
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述（并行模式）...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_parallel] 开始并行生成情感描述
[INFO] [utils.sentence]   实体数量: 7
[INFO] [utils.sentence]   并行度: 5
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Count' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Madame de Morcerf' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'muscatel grapes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'refreshment' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'Mercedes' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, discomfort, distrust, aversion
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'visit' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, resentment, aversion
[INFO] [utils.sentence]   进度: 2/7 (1.84s)
[INFO] [utils.sentence] [Sentence.generate_affective_description] 开始为实体 'house' 生成情感描述
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, distrust, coldness, aversion, pride, disdain
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: rejection, coldness, bitterness, resentment, distrust
[INFO] [utils.sentence]   进度: 4/7 (2.01s)
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: distrust, suspicion, resolve, pride, rejection
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: resentment, refusal, distrust, hostility, tension
[INFO] [utils.sentence]   进度: 6/7 (3.66s)
[INFO] [utils.sentence] [Sentence.generate_affective_description] 成功生成描述: distrust, suspicion, rejection, defiance, tension
[INFO] [utils.sentence]   进度: 7/7 (3.99s)
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_parallel] 并行生成完成 (4.00s, 7/7 成功)
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始批量生成情绪嵌入向量...
[INFO] [particle.emotion_v2]   使用批量Embedding调用（优化方案二）
[INFO] [particle.emotion_v2] Batch embedding: 0 cache hits, 7 cache misses
[INFO] [particle.emotion_v2] Generated 7 embeddings (batch + cache)
[INFO] [particle.emotion_v2] [EmotionV2.process] 批量嵌入生成完成，共 7 个向量
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767227525_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767227525_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767227525_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767227525_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767227525_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767227525_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767227525_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767227525_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767227525_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767227525_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767227525_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767227525_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767227525_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767227525_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767227525_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767227525_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767227525_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767227525_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767227525_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767227525_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767227525_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767227525
[INFO] [workflow.graph_fusion_retrieval]   ✓ 抽取到 7 个实体: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 2: 获取 query embedding
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [workflow.graph_fusion_retrieval]   ✓ Query embedding 准备完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 3: HippoRAG 语义扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 语义扩展找到 0 个相似实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 4: Amygdala 情绪扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 情绪扩展找到 0 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 5: 提取 HippoRAG fact 实体
[INFO] [workflow.graph_fusion_retrieval]   ✓ Fact 扩展找到 19 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 6: 融合实体权重
[INFO] [workflow.graph_fusion_retrieval]     - Query 实体: 7
[INFO] [workflow.graph_fusion_retrieval]     - 语义实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - 情绪实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - Fact 实体: 19
[INFO] [workflow.graph_fusion_retrieval]     - 合并后唯一实体: 26
[INFO] [workflow.graph_fusion_retrieval]   ✓ 融合后共有 46 个实体节点
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 7: 运行 PPR 传播
[INFO] [workflow.graph_fusion_retrieval]   ✓ PPR 完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 检索完成，耗时 5.69s
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [__main__] 
【融合检索结果】（耗时: 5.69s）
[INFO] [__main__]   Rank 1: 情感对峙 (PPR分数: 0.0111)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (PPR分数: 0.0175)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (PPR分数: 0.0165)
[INFO] [__main__]   Rank 4: 药丸场景 (PPR分数: 0.0192)
[INFO] [__main__]   Rank 5: 早餐场景 (PPR分数: 0.0231)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 2】HippoRAG 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [workflow.hipporag_wrapper] Retrieving top-5 chunks for query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morce...
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 融合检索对比测试（快速版）：GraphFusion vs HippoRAG vs Amygdala
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
【使用已有数据库初始化系统】
[INFO] [__main__] 
[1/3] 加载图谱融合检索器...
[INFO] [workflow.graph_fusion_retrieval] 初始化 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_cache] EmotionCache initialized with cache_dir: ./emotion_cache
[INFO] [particle.emotion_v2] EmotionV2 caching enabled: cache_dir=./emotion_cache
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2, cache=enabled
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3, batch_prompt: True
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [chromadb.telemetry.product.posthog] Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ Amygdala 初始化完成
[INFO] [workflow.graph_fusion_retrieval] 初始化 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ HippoRAG 初始化完成
[INFO] [workflow.graph_fusion_retrieval] ✓ 图谱融合检索器初始化完成
[INFO] [__main__] ✓ 图谱融合检索器加载完成
[INFO] [__main__] 
[2/3] 加载 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [__main__] ✓ HippoRAG 加载完成
[INFO] [__main__] 
[3/3] 加载 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_cache] EmotionCache initialized with cache_dir: ./emotion_cache
[INFO] [particle.emotion_v2] EmotionV2 caching enabled: cache_dir=./emotion_cache
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2, cache=enabled
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3, batch_prompt: True
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [__main__] ✓ Amygdala 加载完成
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 1】图谱融合检索
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offere...
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 开始融合检索
[INFO] [workflow.graph_fusion_retrieval]   Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [workflow.graph_fusion_retrieval]   权重配置: emotion=0.3, semantic=0.5, fact=0.2
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 1: 从 query 抽取实体
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767494695
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767494695
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述（批量Prompt模式）...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 开始批量生成情感描述
[INFO] [utils.sentence]   实体数量: 7
[INFO] [utils.sentence] [Batch] 原始响应: Count: suspicion, distrust, resolve, restraint, defiance, pride  
muscatel grapes: rejection, aversion, distrust, contempt  
refreshment: refusal, distrust, avoidance, defiance  
Madame de Morcerf: su...
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 批量生成完成 (1.69s, 7/7 成功)
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始批量生成情绪嵌入向量...
[INFO] [particle.emotion_v2]   使用批量Embedding调用（优化方案二）
[INFO] [particle.emotion_v2] Batch embedding: 0 cache hits, 7 cache misses
[INFO] [particle.emotion_v2] Generated 7 embeddings (batch + cache)
[INFO] [particle.emotion_v2] [EmotionV2.process] 批量嵌入生成完成，共 7 个向量
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494695_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494695_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494695_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494695_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494695_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494695_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494695_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767494695_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767494695_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767494695_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767494695_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767494695_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767494695_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767494695_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767494695_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767494695_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767494695_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767494695_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767494695_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767494695_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767494695_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767494695
[INFO] [workflow.graph_fusion_retrieval]   ✓ 抽取到 7 个实体: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 2: 获取 query embedding
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [workflow.graph_fusion_retrieval]   ✓ Query embedding 准备完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 3: HippoRAG 语义扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 语义扩展找到 0 个相似实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 4: Amygdala 情绪扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 情绪扩展找到 0 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 5: 提取 HippoRAG fact 实体
[INFO] [workflow.graph_fusion_retrieval]   ✓ Fact 扩展找到 19 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 6: 融合实体权重
[INFO] [workflow.graph_fusion_retrieval]     - Query 实体: 7
[INFO] [workflow.graph_fusion_retrieval]     - 语义实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - 情绪实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - Fact 实体: 19
[INFO] [workflow.graph_fusion_retrieval]     - 合并后唯一实体: 26
[INFO] [workflow.graph_fusion_retrieval]   ✓ 融合后共有 46 个实体节点
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 7: 运行 PPR 传播
[INFO] [workflow.graph_fusion_retrieval]   ✓ PPR 完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 检索完成，耗时 3.70s
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [__main__] 
【融合检索结果】（耗时: 3.70s）
[INFO] [__main__]   Rank 1: 情感对峙 (PPR分数: 0.0111)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (PPR分数: 0.0175)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (PPR分数: 0.0165)
[INFO] [__main__]   Rank 4: 药丸场景 (PPR分数: 0.0192)
[INFO] [__main__]   Rank 5: 早餐场景 (PPR分数: 0.0231)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 2】HippoRAG 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [workflow.hipporag_wrapper] Retrieving top-5 chunks for query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morce...
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [hipporag.HippoRAG] Total Retrieval Time 1.01s
[INFO] [hipporag.HippoRAG] Total Recognition Memory Time 0.02s
[INFO] [hipporag.HippoRAG] Total PPR Time 0.00s
[INFO] [hipporag.HippoRAG] Total Misc Time 0.99s
[INFO] [workflow.hipporag_wrapper] ✓ Retrieved 5 chunks
[INFO] [__main__] 
【HippoRAG 结果】（耗时: 1.01s）
[INFO] [__main__]   Rank 1: 情感对峙 (分数: 0.0366)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (分数: 0.0305)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (分数: 0.0223)
[INFO] [__main__]   Rank 4: 早餐场景 (分数: 0.0043)
[INFO] [__main__]   Rank 5: 药丸场景 (分数: 0.0014)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 3】Amygdala 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767494700
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767494700
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述（批量Prompt模式）...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 开始批量生成情感描述
[INFO] [utils.sentence]   实体数量: 7
[INFO] [utils.sentence] [Batch] 原始响应: Count: suspicion, resolve, disdain, pride, mistrust  
muscatel grapes: aversion, rejection, distrust, contempt  
refreshment: refusal, coldness, defiance, detachment  
Madame de Morcerf: offering, ant...
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 批量生成完成 (1.67s, 7/7 成功)
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始批量生成情绪嵌入向量...
[INFO] [particle.emotion_v2]   使用批量Embedding调用（优化方案二）
[INFO] [particle.emotion_v2] Batch embedding: 0 cache hits, 7 cache misses
[INFO] [particle.emotion_v2] Generated 7 embeddings (batch + cache)
[INFO] [particle.emotion_v2] [EmotionV2.process] 批量嵌入生成完成，共 7 个向量
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494700_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494700_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494700_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494700_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494700_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494700_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494700_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767494700_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767494700_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767494700_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767494700_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767494700_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767494700_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767494700_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767494700_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767494700_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767494700_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767494700_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767494700_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767494700_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767494700_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767494700
[INFO] [__main__] 
【Amygdala 结果】（耗时: 2.61s）
[INFO] [__main__]   未检索到结果
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【详细对比分析】
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 1. 排名对比
[INFO] [__main__] ================================================================================
[INFO] [__main__] 
检索方式            情感对峙         东方哲学         拒绝葡萄干        药丸场景         早餐场景        
[INFO] [__main__] --------------------------------------------------------------------------------
[INFO] [__main__] 图谱融合            1           3           2           4           5           
[INFO] [__main__] HippoRAG        1           3           2           5           4           
[INFO] [__main__] Amygdala        -           -           -           -           -           
[INFO] [__main__] 
平均排名（越低越好）:
[INFO] [__main__] 检索方式            平均排名            标准差            
[INFO] [__main__] -------------------------------------------------------
[INFO] [__main__] 图谱融合            3.00            1.41           
[INFO] [__main__] HippoRAG        3.00            1.41           
[INFO] [__main__] Amygdala        -               -              
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 2. Top-3 命中率（关键 chunks：情感对峙、东方哲学、拒绝葡萄干）
[INFO] [__main__] ================================================================================
[INFO] [__main__]   图谱融合           : 3/3 命中 (命中率: 100.0%)
[INFO] [__main__]   HippoRAG       : 3/3 命中 (命中率: 100.0%)
[INFO] [__main__]   Amygdala       : 0/3 命中 (命中率: 0.0%)
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 3. Top-1 准确率（情感对峙 - 最关键答案）
[INFO] [__main__] ================================================================================
[INFO] [__main__]   图谱融合           : ✓ Rank 1 (完美)
[INFO] [__main__]   HippoRAG       : ✓ Rank 1 (完美)
[INFO] [__main__]   Amygdala       : ✗ 未检索到
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 4. 检索性能对比
[INFO] [__main__] ================================================================================
[INFO] [__main__] 
检索方式            时间(s)           相对倍数           
[INFO] [__main__] -------------------------------------------------------
[INFO] [__main__] 图谱融合            3.70            3.65           x
[INFO] [__main__] HippoRAG        1.01            1.00           x
[INFO] [__main__] Amygdala        2.61            2.57           x
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【总结分析】
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
📊 检索效果总结:
[INFO] [__main__] 
检索方式            平均排名         Top-3命中率        Top-1准确率    
[INFO] [__main__] -----------------------------------------------------------------
[INFO] [__main__] 图谱融合            3.00         100.0          % 1.0         %
[INFO] [__main__] HippoRAG        3.00         100.0          % 1.0         %
[INFO] [__main__] 
💡 推荐建议:
[INFO] [__main__]   • 追求检索质量: 图谱融合 (平均排名: 3.00)
[INFO] [__main__]   • 追求最佳答案: 图谱融合 (Top-1 准确率: 100.0%)
[INFO] [__main__]   • 追求检索速度: HippoRAG (耗时: 1.01s)
[INFO] [__main__]   • 追求稳定性: 图谱融合 (Top-3 命中率: 100.0%)
[INFO] [__main__] 
🎯 综合评估:
[INFO] [__main__]   图谱融合: 84.0/100
[INFO] [__main__]   HippoRAG: 84.0/100
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 测试完成！
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
日志已保存到: log/test_fusion_comparison_quick.log
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 融合检索对比测试（快速版）：GraphFusion vs HippoRAG vs Amygdala
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
【使用已有数据库初始化系统】
[INFO] [__main__] 
[1/3] 加载图谱融合检索器...
[INFO] [workflow.graph_fusion_retrieval] 初始化 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_cache] EmotionCache initialized with cache_dir: ./emotion_cache
[INFO] [particle.emotion_v2] EmotionV2 caching enabled: cache_dir=./emotion_cache
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2, cache=enabled
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3, batch_prompt: True
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [chromadb.telemetry.product.posthog] Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ Amygdala 初始化完成
[INFO] [workflow.graph_fusion_retrieval] 初始化 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ HippoRAG 初始化完成
[INFO] [workflow.graph_fusion_retrieval] ✓ 图谱融合检索器初始化完成
[INFO] [__main__] ✓ 图谱融合检索器加载完成
[INFO] [__main__] 
[2/3] 加载 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [__main__] ✓ HippoRAG 加载完成
[INFO] [__main__] 
[3/3] 加载 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_cache] EmotionCache initialized with cache_dir: ./emotion_cache
[INFO] [particle.emotion_v2] EmotionV2 caching enabled: cache_dir=./emotion_cache
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2, cache=enabled
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3, batch_prompt: True
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [__main__] ✓ Amygdala 加载完成
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 1】图谱融合检索
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offere...
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 开始融合检索
[INFO] [workflow.graph_fusion_retrieval]   Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [workflow.graph_fusion_retrieval]   权重配置: emotion=0.3, semantic=0.5, fact=0.2
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 1: 从 query 抽取实体
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767494912
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767494912
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述（批量Prompt模式）...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 开始批量生成情感描述
[INFO] [utils.sentence]   实体数量: 7
[INFO] [utils.sentence] [Batch] 原始响应: Count: disdain, rejection, resolve, coldness, pride, defiance  
muscatel grapes: rejection, contempt, avoidance, disdain  
refreshment: refusal, aversion, rejection, avoidance  
Madame de Morcerf: off...
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 批量生成完成 (1.43s, 7/7 成功)
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始批量生成情绪嵌入向量...
[INFO] [particle.emotion_v2]   使用批量Embedding调用（优化方案二）
[INFO] [particle.emotion_v2] Batch embedding: 0 cache hits, 7 cache misses
[INFO] [particle.emotion_v2] Generated 7 embeddings (batch + cache)
[INFO] [particle.emotion_v2] [EmotionV2.process] 批量嵌入生成完成，共 7 个向量
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494912_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494912_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494912_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494912_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494912_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494912_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494912_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767494912_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767494912_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767494912_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767494912_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767494912_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767494912_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767494912_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767494912_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767494912_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767494912_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767494912_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767494912_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767494912_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767494912_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767494912
[INFO] [workflow.graph_fusion_retrieval]   ✓ 抽取到 7 个实体: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 2: 获取 query embedding
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [workflow.graph_fusion_retrieval]   ✓ Query embedding 准备完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 3: HippoRAG 语义扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 语义扩展找到 0 个相似实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 4: Amygdala 情绪扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 情绪扩展找到 0 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 5: 提取 HippoRAG fact 实体
[INFO] [workflow.graph_fusion_retrieval]   ✓ Fact 扩展找到 19 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 6: 融合实体权重
[INFO] [workflow.graph_fusion_retrieval]     - Query 实体: 7
[INFO] [workflow.graph_fusion_retrieval]     - 语义实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - 情绪实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - Fact 实体: 19
[INFO] [workflow.graph_fusion_retrieval]     - 合并后唯一实体: 26
[INFO] [workflow.graph_fusion_retrieval]   ✓ 融合后共有 46 个实体节点
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 7: 运行 PPR 传播
[INFO] [workflow.graph_fusion_retrieval]   ✓ PPR 完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 检索完成，耗时 3.54s
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [__main__] 
【融合检索结果】（耗时: 3.54s）
[INFO] [__main__]   Rank 1: 情感对峙 (PPR分数: 0.0111)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (PPR分数: 0.0175)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (PPR分数: 0.0165)
[INFO] [__main__]   Rank 4: 药丸场景 (PPR分数: 0.0192)
[INFO] [__main__]   Rank 5: 早餐场景 (PPR分数: 0.0231)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 2】HippoRAG 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [workflow.hipporag_wrapper] Retrieving top-5 chunks for query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morce...
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [hipporag.HippoRAG] Total Retrieval Time 0.90s
[INFO] [hipporag.HippoRAG] Total Recognition Memory Time 0.03s
[INFO] [hipporag.HippoRAG] Total PPR Time 0.00s
[INFO] [hipporag.HippoRAG] Total Misc Time 0.88s
[INFO] [workflow.hipporag_wrapper] ✓ Retrieved 5 chunks
[INFO] [__main__] 
【HippoRAG 结果】（耗时: 0.90s）
[INFO] [__main__]   Rank 1: 情感对峙 (分数: 0.0366)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (分数: 0.0305)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (分数: 0.0223)
[INFO] [__main__]   Rank 4: 早餐场景 (分数: 0.0043)
[INFO] [__main__]   Rank 5: 药丸场景 (分数: 0.0014)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 3】Amygdala 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767494917
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767494917
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述（批量Prompt模式）...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 开始批量生成情感描述
[INFO] [utils.sentence]   实体数量: 7
[INFO] [utils.sentence] [Batch] 原始响应: Count: suspicion, defiance, resolve, restraint, distrust, pride  
muscatel grapes: rejection, aversion, suspicion, disdain  
refreshment: refusal, avoidance, caution, tension  
Madame de Morcerf: offe...
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 批量生成完成 (1.52s, 7/7 成功)
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始批量生成情绪嵌入向量...
[INFO] [particle.emotion_v2]   使用批量Embedding调用（优化方案二）
[INFO] [particle.emotion_v2] Batch embedding: 0 cache hits, 7 cache misses
[INFO] [particle.emotion_v2] Generated 7 embeddings (batch + cache)
[INFO] [particle.emotion_v2] [EmotionV2.process] 批量嵌入生成完成，共 7 个向量
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494917_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494917_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494917_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494917_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494917_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494917_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767494917_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767494917_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767494917_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767494917_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767494917_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767494917_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767494917_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767494917_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767494917_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767494917_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767494917_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767494917_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767494917_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767494917_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767494917_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767494917
[INFO] [__main__] 
【Amygdala 结果】（耗时: 2.33s）
[INFO] [__main__]   未检索到结果
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【详细对比分析】
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 1. 排名对比
[INFO] [__main__] ================================================================================
[INFO] [__main__] 
检索方式            情感对峙         东方哲学         拒绝葡萄干        药丸场景         早餐场景        
[INFO] [__main__] --------------------------------------------------------------------------------
[INFO] [__main__] 图谱融合            1           3           2           4           5           
[INFO] [__main__] HippoRAG        1           3           2           5           4           
[INFO] [__main__] Amygdala        -           -           -           -           -           
[INFO] [__main__] 
平均排名（越低越好）:
[INFO] [__main__] 检索方式            平均排名            标准差            
[INFO] [__main__] -------------------------------------------------------
[INFO] [__main__] 图谱融合            3.00            1.41           
[INFO] [__main__] HippoRAG        3.00            1.41           
[INFO] [__main__] Amygdala        -               -              
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 2. Top-3 命中率（关键 chunks：情感对峙、东方哲学、拒绝葡萄干）
[INFO] [__main__] ================================================================================
[INFO] [__main__]   图谱融合           : 3/3 命中 (命中率: 100.0%)
[INFO] [__main__]   HippoRAG       : 3/3 命中 (命中率: 100.0%)
[INFO] [__main__]   Amygdala       : 0/3 命中 (命中率: 0.0%)
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 3. Top-1 准确率（情感对峙 - 最关键答案）
[INFO] [__main__] ================================================================================
[INFO] [__main__]   图谱融合           : ✓ Rank 1 (完美)
[INFO] [__main__]   HippoRAG       : ✓ Rank 1 (完美)
[INFO] [__main__]   Amygdala       : ✗ 未检索到
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 4. 检索性能对比
[INFO] [__main__] ================================================================================
[INFO] [__main__] 
检索方式            时间(s)           相对倍数           
[INFO] [__main__] -------------------------------------------------------
[INFO] [__main__] 图谱融合            3.54            3.91           x
[INFO] [__main__] HippoRAG        0.90            1.00           x
[INFO] [__main__] Amygdala        2.33            2.58           x
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【总结分析】
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
📊 检索效果总结:
[INFO] [__main__] 
检索方式            平均排名         Top-3命中率        Top-1准确率    
[INFO] [__main__] -----------------------------------------------------------------
[INFO] [__main__] 图谱融合            3.00         100.0          % 1.0         %
[INFO] [__main__] HippoRAG        3.00         100.0          % 1.0         %
[INFO] [__main__] 
💡 推荐建议:
[INFO] [__main__]   • 追求检索质量: 图谱融合 (平均排名: 3.00)
[INFO] [__main__]   • 追求最佳答案: 图谱融合 (Top-1 准确率: 100.0%)
[INFO] [__main__]   • 追求检索速度: HippoRAG (耗时: 0.90s)
[INFO] [__main__]   • 追求稳定性: 图谱融合 (Top-3 命中率: 100.0%)
[INFO] [__main__] 
🎯 综合评估:
[INFO] [__main__]   图谱融合: 84.0/100
[INFO] [__main__]   HippoRAG: 84.0/100
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 测试完成！
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
日志已保存到: log/test_fusion_comparison_quick.log
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 融合检索对比测试（快速版）：GraphFusion vs HippoRAG vs Amygdala
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
【使用已有数据库初始化系统】
[INFO] [__main__] 
[1/3] 加载图谱融合检索器...
[INFO] [workflow.graph_fusion_retrieval] 初始化 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_cache] EmotionCache initialized with cache_dir: ./emotion_cache
[INFO] [particle.emotion_v2] EmotionV2 caching enabled: cache_dir=./emotion_cache
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2, cache=enabled
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3, batch_prompt: True
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [chromadb.telemetry.product.posthog] Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ Amygdala 初始化完成
[INFO] [workflow.graph_fusion_retrieval] 初始化 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [workflow.graph_fusion_retrieval] ✓ HippoRAG 初始化完成
[INFO] [workflow.graph_fusion_retrieval] ✓ 图谱融合检索器初始化完成
[INFO] [__main__] ✓ 图谱融合检索器加载完成
[INFO] [__main__] 
[2/3] 加载 HippoRAG...
[INFO] [workflow.hipporag_wrapper] Initializing HippoRAG wrapper with save_dir: ./test_graph_fusion_hipporag_db
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [hipporag.HippoRAG] Loaded graph from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/graph.pickle with 46 nodes, 130 edges
[INFO] [hipporag.embedding_store] Loaded 5 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/chunk_embeddings/vdb_chunk.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/entity_embeddings/vdb_entity.parquet
[INFO] [hipporag.embedding_store] Loaded 41 records from ./test_graph_fusion_hipporag_db/DeepSeek-V3.2_VLLM_GLM-Embedding-3/fact_embeddings/vdb_fact.parquet
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [workflow.hipporag_wrapper] ✓ HippoRAG wrapper initialized
[INFO] [__main__] ✓ HippoRAG 加载完成
[INFO] [__main__] 
[3/3] 加载 Amygdala...
[INFO] [hipporag.prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/hipporag/prompts/templates
[INFO] [utils.entitiy] Entity initialized with model: DeepSeek-V3.2
[INFO] [particle.emotion_cache] EmotionCache initialized with cache_dir: ./emotion_cache
[INFO] [particle.emotion_v2] EmotionV2 caching enabled: cache_dir=./emotion_cache
[INFO] [prompts.prompt_template_manager] Loading templates from directory: /mnt/d/Codes/HyperAmy/prompts/templates
[WARNING] [prompts.prompt_template_manager] Module 'ner_improved' does not define a 'prompt_template'. Skipping.
[INFO] [utils.sentence] Sentence initialized with model: DeepSeek-V3.2, cache=enabled
[INFO] [particle.emotion_v2] EmotionV2 initialized with model: DeepSeek-V3.2, embedding_model: GLM-Embedding-3, batch_prompt: True
[INFO] [particle.speed] Speed module initialized
[INFO] [particle.temperature] Temperature module initialized
[INFO] [particle.particle] Particle module initialized
[INFO] [workflow.amygdala] Particle module initialized
[INFO] [ods.chroma_client] ChromaClient initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [poincare.storage] HyperAmyStorage initialized: path=./hyperamy_db_fusion_particles, collection=fusion_particles
[INFO] [workflow.amygdala] Particle storage initialized: collection=fusion_particles
[INFO] [workflow.amygdala] Loaded 5 conversation records from test_graph_fusion_amygdala_db/conversation_embeddings/vdb_fusion.parquet
[INFO] [workflow.amygdala] Conversation store initialized without embedding model
[INFO] [workflow.amygdala] Loaded 48 relationship mappings for 5 conversations
[INFO] [workflow.amygdala] Amygdala workflow initialized
[INFO] [__main__] ✓ Amygdala 加载完成
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 1】图谱融合检索
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offere...
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 开始融合检索
[INFO] [workflow.graph_fusion_retrieval]   Query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [workflow.graph_fusion_retrieval]   权重配置: emotion=0.3, semantic=0.5, fact=0.2
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 1: 从 query 抽取实体
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767505614
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767505614
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述（批量Prompt模式）...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 开始批量生成情感描述
[INFO] [utils.sentence]   实体数量: 7
[INFO] [utils.sentence] [Batch] 原始响应: Count: resentment, bitterness, pride, disdain, restraint, defiance  
muscatel grapes: rejection, aversion, contempt, suspicion, avoidance  
refreshment: refusal, rejection, disdain, coldness, resistan...
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 批量生成完成 (1.68s, 7/7 成功)
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始批量生成情绪嵌入向量...
[INFO] [particle.emotion_v2]   使用批量Embedding调用（优化方案二）
[INFO] [particle.emotion_v2] Batch embedding: 0 cache hits, 7 cache misses
[INFO] [particle.emotion_v2] Generated 7 embeddings (batch + cache)
[INFO] [particle.emotion_v2] [EmotionV2.process] 批量嵌入生成完成，共 7 个向量
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505614_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505614_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505614_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505614_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505614_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505614_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505614_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767505614_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767505614_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767505614_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767505614_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767505614_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767505614_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767505614_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767505614_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767505614_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767505614_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767505614_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767505614_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767505614_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767505614_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767505614
[INFO] [workflow.graph_fusion_retrieval]   ✓ 抽取到 7 个实体: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 2: 获取 query embedding
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [workflow.graph_fusion_retrieval]   ✓ Query embedding 准备完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 3: HippoRAG 语义扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 语义扩展找到 0 个相似实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 4: Amygdala 情绪扩展
[INFO] [workflow.graph_fusion_retrieval]   ✓ 情绪扩展找到 0 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 5: 提取 HippoRAG fact 实体
[INFO] [workflow.graph_fusion_retrieval]   ✓ Fact 扩展找到 19 个实体
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 6: 融合实体权重
[INFO] [workflow.graph_fusion_retrieval]     - Query 实体: 7
[INFO] [workflow.graph_fusion_retrieval]     - 语义实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - 情绪实体: 0
[INFO] [workflow.graph_fusion_retrieval]     - Fact 实体: 19
[INFO] [workflow.graph_fusion_retrieval]     - 合并后唯一实体: 26
[INFO] [workflow.graph_fusion_retrieval]   ✓ 融合后共有 46 个实体节点
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] Step 7: 运行 PPR 传播
[INFO] [workflow.graph_fusion_retrieval]   ✓ PPR 完成
[INFO] [workflow.graph_fusion_retrieval] [GraphFusionRetriever.retrieve] 检索完成，耗时 3.96s
[INFO] [workflow.graph_fusion_retrieval] ================================================================================
[INFO] [__main__] 
【融合检索结果】（耗时: 3.96s）
[INFO] [__main__]   Rank 1: 情感对峙 (PPR分数: 0.0111)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (PPR分数: 0.0175)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (PPR分数: 0.0165)
[INFO] [__main__]   Rank 4: 药丸场景 (PPR分数: 0.0192)
[INFO] [__main__]   Rank 5: 早餐场景 (PPR分数: 0.0231)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 2】HippoRAG 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [workflow.hipporag_wrapper] Retrieving top-5 chunks for query: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morce...
[INFO] [hipporag.HippoRAG] Preparing for fast retrieval.
[INFO] [hipporag.HippoRAG] Loading keys.
[INFO] [hipporag.HippoRAG] Loading embeddings.
[INFO] [hipporag.HippoRAG] Adding OpenIE triples to graph.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_fact.
[INFO] [hipporag.HippoRAG] Encoding 1 queries for query_to_passage.
[INFO] [hipporag.HippoRAG] Total Retrieval Time 1.04s
[INFO] [hipporag.HippoRAG] Total Recognition Memory Time 0.03s
[INFO] [hipporag.HippoRAG] Total PPR Time 0.00s
[INFO] [hipporag.HippoRAG] Total Misc Time 1.00s
[INFO] [workflow.hipporag_wrapper] ✓ Retrieved 5 chunks
[INFO] [__main__] 
【HippoRAG 结果】（耗时: 1.04s）
[INFO] [__main__]   Rank 1: 情感对峙 (分数: 0.0366)
[INFO] [__main__]   Rank 2: 拒绝葡萄干 (分数: 0.0305)
[INFO] [__main__]   Rank 3: 东方哲学（核心答案） (分数: 0.0223)
[INFO] [__main__]   Rank 4: 早餐场景 (分数: 0.0043)
[INFO] [__main__]   Rank 5: 药丸场景 (分数: 0.0014)
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【测试 3】Amygdala 单独检索
[INFO] [__main__] ====================================================================================================
[INFO] [particle.particle] ================================================================================
[INFO] [particle.particle] [Particle.process] 开始处理文本
[INFO] [particle.particle]   输入 - text_id: query_1767505619
[INFO] [particle.particle]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.particle]   输入 - text_length: 144 字符
[INFO] [particle.particle]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始处理文本
[INFO] [particle.emotion_v2]   输入 - text_id: query_1767505619
[INFO] [particle.emotion_v2]   输入 - text: Why did the Count strictly refuse the muscatel grapes and any refreshment offered by Madame de Morcerf (Mercedes) during his visit to her house?
[INFO] [particle.emotion_v2]   输入 - text_length: 144 字符
[INFO] [particle.emotion_v2]   输入 - entities: None (将自动抽取)
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始抽取实体...
[INFO] [particle.emotion_v2] [EmotionV2.process] 实体抽取完成
[INFO] [particle.emotion_v2]   抽取结果 - 实体数量: 7
[INFO] [particle.emotion_v2]   抽取结果 - 实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始为实体生成情感描述（批量Prompt模式）...
[INFO] [particle.emotion_v2]   实体数量: 7
[INFO] [particle.emotion_v2]   实体列表: ['Count', 'muscatel grapes', 'refreshment', 'Madame de Morcerf', 'Mercedes', 'visit', 'house']
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 开始批量生成情感描述
[INFO] [utils.sentence]   实体数量: 7
[INFO] [utils.sentence] [Batch] 原始响应: Count: resentment, bitterness, pride, resolve, defiance, detachment  
muscatel grapes: rejection, aversion, distrust, disdain  
refreshment: refusal, resistance, suspicion, denial  
Madame de Morcerf:...
[INFO] [utils.sentence] [Sentence.generate_affective_descriptions_batch] 批量生成完成 (1.51s, 7/7 成功)
[INFO] [particle.emotion_v2] [EmotionV2.process] 情感描述生成完成
[INFO] [particle.emotion_v2]   成功生成: 7/7 个描述
[INFO] [particle.emotion_v2] [EmotionV2.process] 开始批量生成情绪嵌入向量...
[INFO] [particle.emotion_v2]   使用批量Embedding调用（优化方案二）
[INFO] [particle.emotion_v2] Batch embedding: 0 cache hits, 7 cache misses
[INFO] [particle.emotion_v2] Generated 7 embeddings (batch + cache)
[INFO] [particle.emotion_v2] [EmotionV2.process] 批量嵌入生成完成，共 7 个向量
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505619_entity_0, entity=Count, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505619_entity_1, entity=muscatel grapes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505619_entity_2, entity=refreshment, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505619_entity_3, entity=Madame de Morcerf, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505619_entity_4, entity=Mercedes, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505619_entity_5, entity=visit, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 成功创建 EmotionNode: entity_id=query_1767505619_entity_6, entity=house, vector_shape=(2048,), vector_norm=1.000000
[INFO] [particle.emotion_v2] [EmotionV2.process] 处理完成
[INFO] [particle.emotion_v2]   成功处理: 7/7 个实体
[INFO] [particle.emotion_v2]   生成的 EmotionNode 列表:
[INFO] [particle.emotion_v2]     1. entity_id=query_1767505619_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     2. entity_id=query_1767505619_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     3. entity_id=query_1767505619_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     4. entity_id=query_1767505619_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     5. entity_id=query_1767505619_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     6. entity_id=query_1767505619_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.emotion_v2]     7. entity_id=query_1767505619_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.emotion_v2] ================================================================================
[INFO] [particle.particle] [Particle.process] 情绪节点提取完成
[INFO] [particle.particle]   提取结果 - emotion_nodes数量: 7
[INFO] [particle.particle]   提取结果 - emotion_nodes详情:
[INFO] [particle.particle]     1. entity_id=query_1767505619_entity_0, entity=Count, vector_shape=(2048,)
[INFO] [particle.particle]     2. entity_id=query_1767505619_entity_1, entity=muscatel grapes, vector_shape=(2048,)
[INFO] [particle.particle]     3. entity_id=query_1767505619_entity_2, entity=refreshment, vector_shape=(2048,)
[INFO] [particle.particle]     4. entity_id=query_1767505619_entity_3, entity=Madame de Morcerf, vector_shape=(2048,)
[INFO] [particle.particle]     5. entity_id=query_1767505619_entity_4, entity=Mercedes, vector_shape=(2048,)
[INFO] [particle.particle]     6. entity_id=query_1767505619_entity_5, entity=visit, vector_shape=(2048,)
[INFO] [particle.particle]     7. entity_id=query_1767505619_entity_6, entity=house, vector_shape=(2048,)
[INFO] [particle.particle] Successfully created 7 particles for text_id: query_1767505619
[INFO] [__main__] 
【Amygdala 结果】（耗时: 2.44s）
[INFO] [__main__]   未检索到结果
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【详细对比分析】
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 1. 排名对比
[INFO] [__main__] ================================================================================
[INFO] [__main__] 
检索方式            情感对峙         东方哲学         拒绝葡萄干        药丸场景         早餐场景        
[INFO] [__main__] --------------------------------------------------------------------------------
[INFO] [__main__] 图谱融合            1           3           2           4           5           
[INFO] [__main__] HippoRAG        1           3           2           5           4           
[INFO] [__main__] Amygdala        -           -           -           -           -           
[INFO] [__main__] 
平均排名（越低越好）:
[INFO] [__main__] 检索方式            平均排名            标准差            
[INFO] [__main__] -------------------------------------------------------
[INFO] [__main__] 图谱融合            3.00            1.41           
[INFO] [__main__] HippoRAG        3.00            1.41           
[INFO] [__main__] Amygdala        -               -              
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 2. Top-3 命中率（关键 chunks：情感对峙、东方哲学、拒绝葡萄干）
[INFO] [__main__] ================================================================================
[INFO] [__main__]   图谱融合           : 3/3 命中 (命中率: 100.0%)
[INFO] [__main__]   HippoRAG       : 3/3 命中 (命中率: 100.0%)
[INFO] [__main__]   Amygdala       : 0/3 命中 (命中率: 0.0%)
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 3. Top-1 准确率（情感对峙 - 最关键答案）
[INFO] [__main__] ================================================================================
[INFO] [__main__]   图谱融合           : ✓ Rank 1 (完美)
[INFO] [__main__]   HippoRAG       : ✓ Rank 1 (完美)
[INFO] [__main__]   Amygdala       : ✗ 未检索到
[INFO] [__main__] 
================================================================================
[INFO] [__main__] 4. 检索性能对比
[INFO] [__main__] ================================================================================
[INFO] [__main__] 
检索方式            时间(s)           相对倍数           
[INFO] [__main__] -------------------------------------------------------
[INFO] [__main__] 图谱融合            3.96            3.81           x
[INFO] [__main__] HippoRAG        1.04            1.00           x
[INFO] [__main__] Amygdala        2.44            2.35           x
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 【总结分析】
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
📊 检索效果总结:
[INFO] [__main__] 
检索方式            平均排名         Top-3命中率        Top-1准确率    
[INFO] [__main__] -----------------------------------------------------------------
[INFO] [__main__] 图谱融合            3.00         100.0          % 1.0         %
[INFO] [__main__] HippoRAG        3.00         100.0          % 1.0         %
[INFO] [__main__] 
💡 推荐建议:
[INFO] [__main__]   • 追求检索质量: 图谱融合 (平均排名: 3.00)
[INFO] [__main__]   • 追求最佳答案: 图谱融合 (Top-1 准确率: 100.0%)
[INFO] [__main__]   • 追求检索速度: HippoRAG (耗时: 1.04s)
[INFO] [__main__]   • 追求稳定性: 图谱融合 (Top-3 命中率: 100.0%)
[INFO] [__main__] 
🎯 综合评估:
[INFO] [__main__]   图谱融合: 84.0/100
[INFO] [__main__]   HippoRAG: 84.0/100
[INFO] [__main__] 
====================================================================================================
[INFO] [__main__] 测试完成！
[INFO] [__main__] ====================================================================================================
[INFO] [__main__] 
日志已保存到: log/test_fusion_comparison_quick.log
