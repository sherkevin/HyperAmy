# HippoRAG + æƒ…æ„Ÿåˆ†ææ•´åˆå®Œæˆè¯´æ˜

## âœ… æ•´åˆå®Œæˆ

å·²æˆåŠŸå°† HyperAmy çš„æƒ…æ„Ÿåˆ†æåŠŸèƒ½æ•´åˆåˆ° HippoRAG æ¡†æ¶ä¸­ã€‚

---

## ğŸ“ æ–°å¢æ–‡ä»¶ç»“æ„

```
Amygdala/
â”œâ”€â”€ sentiment/                          # æ–°å¢ï¼šæƒ…æ„Ÿåˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ __init__.py                     # æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ emotion_vector.py              # æƒ…æ„Ÿå‘é‡æå–ï¼ˆä» HyperAmy æå–ï¼‰
â”‚   â”œâ”€â”€ emotion_store.py                # æƒ…æ„Ÿå‘é‡å­˜å‚¨ï¼ˆç±»ä¼¼ EmbeddingStoreï¼‰
â”‚   â””â”€â”€ hipporag_enhanced.py           # å¢å¼ºç‰ˆ HippoRAGï¼ˆæ·»åŠ æƒ…æ„Ÿåˆ†æï¼‰
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ test_integration.py            # æ•´åˆæµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ test_dataset_integration.py    # æ•°æ®é›†æµ‹è¯•è„šæœ¬
â””â”€â”€ æ•´åˆå®Œæˆè¯´æ˜.md                     # æœ¬æ–‡æ¡£
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æƒ…æ„Ÿå‘é‡æå– (`sentiment/emotion_vector.py`)

- **EmotionExtractor ç±»**: ä»æ–‡æœ¬ä¸­æå– 28 ç»´æƒ…æ„Ÿå‘é‡
- **æ”¯æŒ 30+ ç§æƒ…ç»ª**: åŸºäº Plutchik æƒ…ç»ªè½®
- **API é›†æˆ**: æ”¯æŒå¹¶è¡Œæ™ºèƒ½äº‘ API
- **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡æå–æƒ…æ„Ÿå‘é‡

### 2. æƒ…æ„Ÿå‘é‡å­˜å‚¨ (`sentiment/emotion_store.py`)

- **EmotionStore ç±»**: ç±»ä¼¼ EmbeddingStoreï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†æƒ…æ„Ÿå‘é‡
- **æŒä¹…åŒ–**: ä½¿ç”¨ Parquet æ ¼å¼å­˜å‚¨
- **è‡ªåŠ¨å»é‡**: åŸºäº MD5 hash_id

### 3. å¢å¼ºç‰ˆ HippoRAG (`sentiment/hipporag_enhanced.py`)

- **HippoRAGEnhanced ç±»**: åœ¨åŸæœ‰ HippoRAG åŸºç¡€ä¸Šæ·»åŠ æƒ…æ„Ÿåˆ†æ
- **å¯é€‰å¯ç”¨**: é€šè¿‡ `enable_emotion` å‚æ•°æ§åˆ¶
- **æƒ…æ„Ÿå¢å¼ºæ£€ç´¢**: ç»“åˆè¯­ä¹‰å’Œæƒ…æ„Ÿç›¸ä¼¼åº¦è¿›è¡Œæ£€ç´¢
- **æƒé‡å¯è°ƒ**: é€šè¿‡ `emotion_weight` å‚æ•°è°ƒæ•´æƒ…æ„Ÿæƒé‡

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```python
from sentiment.hipporag_enhanced import HippoRAGEnhanced
from hipporag.utils.config_utils import BaseConfig

# åˆ›å»ºé…ç½®
config = BaseConfig(
    save_dir="outputs/test",
    llm_base_url="https://llmapi.paratera.com/v1",
    llm_name="GLM-4-Flash",
    embedding_model_name="GLM-Embedding-2",
    embedding_base_url="https://llmapi.paratera.com/v1",
)

# åˆå§‹åŒ–å¢å¼ºç‰ˆ HippoRAGï¼ˆå¯ç”¨æƒ…æ„Ÿåˆ†æï¼‰
hipporag = HippoRAGEnhanced(
    global_config=config,
    enable_emotion=True,        # å¯ç”¨æƒ…æ„Ÿåˆ†æ
    emotion_weight=0.3,          # æƒ…æ„Ÿæƒé‡ 30%ï¼Œè¯­ä¹‰æƒé‡ 70%
    emotion_model_name="GLM-4-Flash"
)

# ç´¢å¼•æ–‡æ¡£ï¼ˆè‡ªåŠ¨æå–æƒ…æ„Ÿå‘é‡ï¼‰
docs = ["æ–‡æ¡£1", "æ–‡æ¡£2", ...]
hipporag.index(docs)

# æ£€ç´¢ï¼ˆæƒ…æ„Ÿå¢å¼ºï¼‰
queries = ["é—®é¢˜1", "é—®é¢˜2", ...]
results = hipporag.retrieve(queries)

# é—®ç­”
qa_results, messages, metadata = hipporag.rag_qa(queries)
```

### ç¦ç”¨æƒ…æ„Ÿåˆ†æ

```python
# å¦‚æœä¸æƒ³ä½¿ç”¨æƒ…æ„Ÿåˆ†æï¼Œå¯ä»¥ç¦ç”¨
hipporag = HippoRAGEnhanced(
    global_config=config,
    enable_emotion=False  # ç¦ç”¨æƒ…æ„Ÿåˆ†æï¼Œä½¿ç”¨åŸå§‹ HippoRAG
)
```

---

## ğŸ“Š åŠŸèƒ½ç‰¹ç‚¹

### 1. å‘åå…¼å®¹

- å®Œå…¨å…¼å®¹åŸæœ‰ HippoRAG API
- å¯ä»¥é€šè¿‡ `enable_emotion=False` ç¦ç”¨æƒ…æ„Ÿåˆ†æ
- ä¸å½±å“åŸæœ‰åŠŸèƒ½

### 2. æƒ…æ„Ÿå¢å¼ºæ£€ç´¢

- **è¯­ä¹‰ç›¸ä¼¼åº¦**: åŸºäº embedding çš„è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆæƒé‡: 70%ï¼‰
- **æƒ…æ„Ÿç›¸ä¼¼åº¦**: åŸºäºæƒ…æ„Ÿå‘é‡çš„æƒ…æ„Ÿç›¸ä¼¼åº¦ï¼ˆæƒé‡: 30%ï¼‰
- **ç»“åˆåˆ†æ•°**: `combined_score = 0.7 * semantic_score + 0.3 * emotion_score`

### 3. è‡ªåŠ¨æƒ…æ„Ÿæå–

- åœ¨ `index()` æ—¶è‡ªåŠ¨æå–å®ä½“çš„æƒ…æ„Ÿå‘é‡
- åœ¨ `index()` æ—¶è‡ªåŠ¨æå–æ–‡æ¡£å—çš„æƒ…æ„Ÿå‘é‡
- åœ¨ `retrieve()` æ—¶è‡ªåŠ¨æå–æŸ¥è¯¢çš„æƒ…æ„Ÿå‘é‡

---

## ğŸ§ª æµ‹è¯•

### æµ‹è¯•è„šæœ¬

1. **`scripts/test_integration.py`**: åŸºæœ¬åŠŸèƒ½æµ‹è¯•
2. **`scripts/test_dataset_integration.py`**: æ•°æ®é›†æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# åŸºæœ¬åŠŸèƒ½æµ‹è¯•
python scripts/test_integration.py

# æ•°æ®é›†æµ‹è¯•
python scripts/test_dataset_integration.py
```

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### æƒ…æ„Ÿå‘é‡æå–æµç¨‹

1. ä½¿ç”¨ LLMï¼ˆGLM-4-Flashï¼‰åˆ†ææ–‡æœ¬æƒ…æ„Ÿ
2. æå– 28 ç»´æƒ…æ„Ÿåˆ†æ•°ï¼ˆ0.0-1.0ï¼‰
3. L2 å½’ä¸€åŒ–
4. å­˜å‚¨åˆ° EmotionStore

### æƒ…æ„Ÿå¢å¼ºæ£€ç´¢æµç¨‹

1. æå–æŸ¥è¯¢çš„æƒ…æ„Ÿå‘é‡
2. è®¡ç®—æŸ¥è¯¢ä¸æ¯ä¸ªæ–‡æ¡£çš„æƒ…æ„Ÿç›¸ä¼¼åº¦ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
3. å½’ä¸€åŒ–è¯­ä¹‰åˆ†æ•°å’Œæƒ…æ„Ÿåˆ†æ•°
4. ç»“åˆåˆ†æ•°ï¼š`combined = semantic_weight * semantic + emotion_weight * emotion`
5. é‡æ–°æ’åºæ–‡æ¡£

---

## ğŸ” å…³é”®ä»£ç ä½ç½®

- **æƒ…æ„Ÿæå–**: `sentiment/emotion_vector.py` - `EmotionExtractor.extract_emotion_vector()`
- **æƒ…æ„Ÿå­˜å‚¨**: `sentiment/emotion_store.py` - `EmotionStore.insert_strings()`
- **å¢å¼ºæ£€ç´¢**: `sentiment/hipporag_enhanced.py` - `HippoRAGEnhanced.retrieve()`

---

## âš™ï¸ é…ç½®è¦æ±‚

### API é…ç½®

éœ€è¦é…ç½®å¹¶è¡Œæ™ºèƒ½äº‘ APIï¼š
- API Key: `sk-YaO0f0NsiW-drkCHbnDIHw`
- Base URL: `https://llmapi.paratera.com/v1`
- LLM Model: `GLM-4-Flash`
- Embedding Model: `GLM-Embedding-2`

### ä¾èµ–

- `requests`: HTTP è¯·æ±‚
- `numpy`: æ•°å€¼è®¡ç®—
- `pandas`: æ•°æ®å­˜å‚¨ï¼ˆParquetï¼‰
- HippoRAG åŸæœ‰ä¾èµ–

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. âœ… æ•´åˆå®Œæˆ
2. â­ï¸ åœ¨å®Œæ•´æ•°æ®é›†ä¸Šæµ‹è¯•
3. â­ï¸ ä¼˜åŒ–æƒ…æ„Ÿæƒé‡å‚æ•°
4. â­ï¸ è¯„ä¼°æƒ…æ„Ÿå¢å¼ºçš„æ•ˆæœ

---

## ğŸ“š å‚è€ƒ

- **HyperAmy**: https://github.com/sherkevin/HyperAmy
- **HippoRAG**: https://github.com/OSU-NLP-Group/HippoRAG

---

**åˆ›å»ºæ—¶é—´**: 2024å¹´ï¼ˆå½“å‰ä¼šè¯ï¼‰  
**åˆ†æ”¯**: `amygdala-emotion-integration`

